<!DOCTYPE HTML>
<html>

<head>
    <title>Map Digi Penfro</title>
    <meta name="viewport"
        content="width=device-width, user-scalable=no, minimum-scale=1, maximum-scale=1,initial-scale=1" />
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <script>window.version=1.4;</script>
    <script src="scripts/azure-storage.common.min.js"></script>
    <script src="scripts/azure-storage.blob.min.js"></script>
    <script src="scripts/jquery-3.4.1.min.js"></script>
    <script src="scripts/util.js?v=1.5"></script>
    <script src="scripts/sign-in.js?v=1.5"></script>
    <script src="scripts/exif-js.js"></script>
    <script src="scripts/model.js?v=1.16"></script>
    <script src="scripts/azuredb.js?v=1.20"></script>
    <script src="scripts/maps.js?v=1.16"></script>
    <script src="scripts/text-edit.js?v=1.6"></script>
    <script src="scripts/deep-map.js?v=1.24"></script>
    <script src="scripts/index.js?v=1.22"></script>
    <script src="scripts/track.js?v=1.4"></script>


    <link rel="icon" type="img/png" href="img/favicon96.png" sizes="96x96" />
    <link rel="icon" type="img/png" href="img/favicon32.png" sizes="32x32" />
    <link rel="icon" type="img/png" href="img/favicon16.png" sizes="16x16" />
    <link rel="stylesheet" type="text/css" href="css/deep-map.css?v=1.17" />

    <style>
        #splash {
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 200;
        }

        #splashPanel {
            border-radius: 10px;
            border: black solid 4px;
            background-color: white;
            font: sans-serif 18pt;
            color: darkblue;
            position: absolute;
            top: 5%;
            left: 10%;
            right: 10%;
            bottom: 5%;
            display: block;
        }

        .splashScroller {
            position: absolute;
            top: 0px;
            bottom: 0px;
            overflow: auto;
            padding: 10px;
        }
    </style>

    <script>
        // Occasional problem loading map
        window.restartTimer = setTimeout(() => { window.location.reload(); }, 20000);
    </script>
</head>

<body onload="init()">
    <div>
        <div id='theMap' ondragover="dragOverMap(event)">
            <h2 style="color:grey;font-family: 'Times New Roman', Times, serif">&nbsp;
                <br />
                <br /><span id="loadingMapStatus">Loading the map...</span></h2>
        </div>
    </div>
    <div id="topLayer">
        <div id="loosePicsShow"></div>
        <div id='topLeftControls'>
            <div id="usernamediv" class="panelButton">
                <span id="usernamespan"></span>
                <div id="signOutButton" class='closeX' style="display:none" onclick='signOut()' title='Sign out'>X</div>
                <input id="signInButtonTop" type='button' onclick='signin()' value='Sign in' />
            </div>
            <div id='pauseButton' class='panelButton squareButton' onclick="onPauseButton()"
                title="Pause/resume tracking">
                <small><b>&gt;</b></small></div>
            <div id='showHelpButton' class='panelButton squareButton' onclick="dohelp()" title="help/about">?</div>
            <div id="picLaundryFlag" class='panelButton'
                title="Picture or place upload in progress, or waiting for connection">^</div>
        </div>
        <div id='topMessage' class='noselect' style="visibility: hidden"></div>
        <div id="target" class="target" style="pointer-events:none"
            title="Position a place under here then click the button on the right to add notes">
            <div class="noselect" style="position:relative;top:10px">^</div>
        </div>
        <div id="addPlaceButton" class="addButton" title="Put notes and pictures on the map at the target point"
            onclick="onAddPlaceButton(this)">+</div>

        <img id="mapbutton" onclick="map.toggleType()" title="aerial/OS map" src="img/map-icon.png" />
        <div id="groupSelectorBox"></div>
        <div id="indexSidebar"></div>
        <div id="bottomLeftPanel">
            <div id="toggleLanguageButton" class="panelButton smallButton" onclick='toggleLanguage()'>Cymraeg</div>
            <div id="tagKeyButton" class="panelButton smallButton" onclick="showTagsKey()">Tags</div>
            <input id="searchButton" type="text" class="panelButton smallButton" onchange="doSearch(this.value)"
                style="background-image:url('img/search.png');background-repeat: no-repeat;background-position: right center;cursor:auto;"
                title="search" />
        </div>
        <div id="tagsKey" onclick="hideTagsKey()">
            <div id="tagsKeyPanel">
                <div id="id2">
                    <div class="tagKeyButton"></div> Rocks
                </div>
            </div>
        </div>
        <!-- Button for adding pics or other files to a place -->
        <div id="addFileButton" class="addButton" title="Upload pics and then place them on the map"
            onclick="showFileSelectDialog('uploadButton')">++</div>
        <input id="uploadButton" style="display:none;opacity: 0;" onchange="doUploadFiles(this, this.files, null)"
            type="file" title="upload" name="uploadButton" multiple />
        <div id="basehelp" style="display:none">
            <h4 id="helpRefAddHead">Add places to the map</h4>
            <p id="helpRefDragMap">Drag the map so that the <span id="helpRefTarget">target <b>^</b></span> points to a
                place you have something
                to show or tell about.</p>
            <p id="helpRefTracking">If you're mobile, click &gt; to track your position.</p>
            <p id="helpRefAdd">Click <b>+</b> to create a place at the target. You'll then be able to type notes or add
                photos or sound files.</p>
            <p id="helpRefAddPics">If you have photos of several places, click <b>++</b> to put them on the map in one
                go.
            </p>
            <button onclick="closeBaseHelp()" id="closeHelpButton" class="continueButton">Close but show help as I go
                along</button>
            <a href="img/user-guide.pdf" target="_blank"><button >Open user guide</button></a>
            <svg id="svgBaseHelp"></svg>
        </div>
        <div id="popup" class="floatingPopup">
            <div id="popuptextgroup">
                <div id="toolBar1">
                    <div class="toolbutton" onclick="onFormatDoc('formatblock','h4')" id="toolHead" title="Sub heading">
                        H
                    </div>
                    <div class="toolbutton" onclick="onFormatDoc('formatblock','div')" id="toolPara"
                        title="Plain paragraph">¶</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','â')">â</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','ê')">ê</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','î')">î</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','ô')">ô</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','û')">û</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','ŵ')">ŵ</div>
                    <div class="toolbutton" onclick="onFormatDoc('InsertText','ŷ')">ŷ</div>
                    <div class="toolbutton" onclick="onCreateLink()" id="inserLinkButton" title="Insert link"><img
                            src="img/link.png" width="18px" height="18px"></div>
                    <span id="groupEditorBox"></span>
                    <div id="popupTimestampTextBox" class="toolbutton"
                        style="position:absolute;right:0px;background-color:rgba(0,0,0,0);color:black"></div>
                </div>
                <div class="popupTextBox">
                    <div class="popupTextTopLine">TITLE
                    </div>
                    <div class="popupcontent">
                        <div id="popuptext" contenteditable="true" onclick="event.stopPropagation()">
                        </div>
                        <div id="popupComments"></div>
                    </div>
                </div>
            </div>
            <div id="tags"> </div>
            <div id="author"> </div>
            <div id="popclose" onclick="closePopup()">X</div>
            <div id="picturebar" class="picturebar">
                <span id="picPrompt">Add pictures &gt;</span>
                <div id="thumbnails"></div>
                <!-- The add button displays the ugly traditional "input file" and clicks it -->
                <div class="addButton addInlineButton" id="addPicToPlaceButton"
                    onclick="showFileSelectDialog('uploadToPlaceButton')"
                    title="Add photos, sound files or videos to this note">+</div>
                <!-- But we set opacity:0 so the ugly input isn't visible, even when 'displayed' -->
                <input id="uploadToPlaceButton" style="display:none;opacity: 0;"
                    onchange="doUploadFiles(this, this.files, g('popup').placePoint)" type="file" title="upload"
                    name="uploadToPlaceButton" multiple />
                <div id="getLinkButton" class="addButton addInlineButton"
                    onclick="showLink(g('popup').placePoint.place, event)" title="Get link to place">
                    <img src="img/getlink.png" />
                </div>
                <div id="editorHelpButton" class="addButton addInlineButton" onclick="showEditorHelp()" title="Help">?
                </div>
            </div>
            <div id="editorHelp">
                <div id="editorHelpContent">
                    <p id="eh1">Type a title and notes related to this place.You need at least the first line, which is
                        the
                        title. </p>
                    <p id="eh2">Select one or more coloured tags to show roughly what this is about.</p>
                    <p id="eh3">Add pictures, sound files, or other files. The pictures will play in sequence like a
                        slide show. Drag a thumbnail to change the sequence. Right-click/long-touch a picture to give it
                        a title.
                        To have a sound file play while the slides change, upload the file here.</p>
                    <p id="eh4">To synchronise sounds and pictures, use a sound app to snip the sound file into separate
                        parts for each picture.
                        Right-click/long-touch each picture to attach its sound file.</p>
                    <p id="eh5">To attach a YouTube video, first add a picture. Then in YouTube, get a share link like
                        https://youtu.be/...
                        Then back here, right-click/long-touch the picture and paste the link.
                    </p>
                    <button id="closeEditorHelpButton" onclick="closeEditorHelp()">Close</button>
                    <a href="img/user-guide.pdf" target="_blank"><button>User guide</button></a>
                </div>
                <div id="editorHelpCloser" class="closeX boxClose" onclick="closeEditorHelp()">X</div>
                <svg id="editorHelpSvg"></svg>
            </div>
        </div>

        <!-- autoplay => Track will play automatically if user has clicked at least once in the page. -->
        <div id="audiodiv" class="avbox"><audio id='audiocontrol' controls='controls' autoplay='autoplay'
                type='audio/mpeg'></audio></div>


        <div id="petals" class="petals ">
            <div id="petaltext" class="petaltext"></div>
        </div>

        <div id="lightbox" class="lightbox" onclick="hidePic()">
            <div id="lightboxTop"></div>
            <div id="lightboxMid">
                <img id="lightboxImg" />
                <div id="lightboxCaption" contenteditable onclick="event.cancelBubble=true">
                </div>
                <img id="lightboxExpand" onclick="expandPic(event)" src="img/expand.png"
                    title="expand image in new window" />
            </div>
            <div id="lightboxBottom">
                <div id="lightboxBottomText"></div>
                <div id="lightboxComments" onclick=" doLightBoxNext(0, event)"></div>
            </div>
            <div class="leftside lightboxside" onclick="return doLightBoxNext(-1, event)">
                <div>&#10094;</div>
            </div>
            <div class="rightside lightboxside" onclick="return doLightBoxNext(1, event)">
                <div>&#10095;</div>
            </div>
            <div id="lightboxTopBar">
                <div class="lightBoxAuthorBox">
                    <span id="lightboxAuthor"></span><br /><span id="contactUs"
                        onclick="contactx(event, g('lightbox').currentPin.place)" class="smallButton">Contact us about
                        this
                        item</span></div>
                <div id="getLinkButton2" class="addButton addInlineButton"
                    onclick="showLink(g('lightbox').currentPin.place, event)" title="Get link to place">
                    <img src="img/getlink.png" /></div>
                <div id="lightboxEditButton" class="addButton addInlineButton" onclick="switchToEdit()" title="Edit">
                    <img src="img/edit.png" /></div>
            </div>
            <div id="lightboxBack" class='panelButton squareButton' title="back to map">X</div>
        </div>

        <div id="loosePicMenu" class="menu" onmouseleave="this.style.display='none'">
            <div>&nbsp;</div>
            <div onclick="onmenuclick(this, placeLoosePicCmd)" id="placeLoosePicMenu">Place at focus mark</div>
        </div>

        <div id="petalMenu" class="menu" onmouseleave="this.style.display='none'">
            <div>&nbsp;</div>
            <div onclick="onmenuclick(this, titlePicCmd)" id="retitlePicMenu">Re-title pic/file</div>
            <div onclick="onmenuclick(this, deletePicCmd)" id="deletePicMenu">Delete pic/file</div>
            <div onclick="onmenuclick(this, attachSoundCmd)" id="attachSoundMenu">Attach a sound file</div>
            <div onclick="onmenuclick(this, attachYouTube)" id="attachYouTubeMenu">Attach a YouTube video</div>
            <div onclick="onmenuclick(this, rotatePicCmd)" id="rot90Menu">Rotate 90deg</div>
            <!-- <div onclick="onmenuclick(this, movePicCmd)" id="movePicMenu">Move pic/file to another place</div> -->
        </div>

        <div id="petalTextMenu" class="menu" onmouseleave="this.style.display='none'">
            <div>&nbsp;</div>
            <div onclick="onmenuclick(this, movePlaceCmd)" id="movePlaceMenu">Move place to target</div>
            <div onclick="onmenuclick(this, deletePlaceCmd)" id="deletePlaceMenu">Delete place</div>
            <div onclick="onmenuclick(this, startTrailCmd)" id="startTrailMenu">Start trail</div>
            <div onclick="onmenuclick(this, continueTrailCmd)" id="continueTrailMenu">Continue trail</div>
        </div>

        <div id="titleDialog" onclick="this.style.display='none'"
            style="display:none;position:absolute;top:0px;left:0px;bottom:0px;right:0px;background-color:rgba(0,0,0,0.5)">
            <div
                style="position:relative;top:30%;max-width:80%; margin: 0 auto;background-color:white;border: 2 solid blue; padding:10px;">
                <p id="editTitlePrompt">Edit the title</p>
                <input id="titleInput" type="text" size="40" onchange="this.whenDone(this.value)" />
            </div>
        </div>

        <!-- Input dialog for adding a sound file to a pic -->
        <input id="attachSoundInput" style="display:none;opacity: 0;" onchange="doAttachSound(this)" type="file"
            title="sound file" name="attachSoundInput" />

        <!-- Creating a link in the editor -->
        <div id="linkDialog" class="dialog" onClick="this.style.display='none'">
            <div onclick="noPropagate(event)">Paste a link to a web page here:
                <br />
                <input id="linkRef" type="text" size="20" pattern="https?://.+|\.\/\?place=[0-9]{3}"
                    placeholder="http://..." />
                <input type="button" onclick="CompleteCreateLink()" value="Link" />
                <span id="linkRemoveOption">
                    - or -
                    <br />
                    <input type="button" onclick="CompleteRemoveLink()" value="Remove link" />
                </span>
            </div>
        </div>


        <!--div style="position:fixed; top:0px; left: 0px;padding:4px;background-color:yellow" id="msg"></div -->
        <div id="splash">
            <div id="splashPanel">
                <div class="splashScroller" id="folioSplash">
                    <img src="img/folio.png" style="width:90%;height:auto;margin:auto;" />
                    <h1>Mapping our Memories</h1>
                    <h3>Join us in building a shared record of our memories and stories about Sutton Coldfield.</h3>
                    <p>Here you can contribute your notes, photos, old documents and more about our town. 
                        We want to collaboratively build a rich, grassroots history of Sutton Coldfield. 
                        We’d love you to contribute what matters and is of interest to you.
                    </p>
                    <p>Click the points on this map to see what people have recorded so far.</p>
                    <p>If you would like to add a memory or a document - perhaps relating to the history of your house, 
                        memories of working for a local company or any other aspect of our shared local history,
                        please email <a href="mailto:map@foliosuttoncoldfield.org.uk">map@foliosuttoncoldfield.org.uk</a>
                        to get the ball rolling. 
                        We really look forward to hearing from you.
                    </p>
                    <hr />
                    <p id="loadingFlag" style="background-color:yellow">Loading...</p>
                    <button id="continueButton" style="display:none;" class="continueButton"
                        onclick="dropSplash()">Continue</button>
                    <p><a href="img/user-guide.pdf" target="_blank">User guide</a>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <a href="http://foliosuttoncoldfield.org.uk/mapping-our-memories/" target="_blank">Read more</a>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <a href="http://foliosuttoncoldfield.org.uk/mapping-our-memories-terms/" target="_blank">Terms</a>

                    </p>
                </div>
                <div class="splashScroller" id="spanSplash">
                    <div>
                        <img src="img/favicon96.png" align="left" /> <span id="aboutEN">
                            <h1>Map Digi Penfro</h1>
                            <h3>Exploring Pembrokeshire from many perspectives</h3>
                            <p>Welcome to the Beta version of Map Digi Penfro, a digital mapping tool
                                that allows you to record what you think is important about the places of Pembrokeshire.
                                The map is a work in progress to which you are invited to contribute.
                            </p>
                            <p>The points on this map record nature, poetry, science, art and history. They have been
                                placed
                                here by people young, old and in between who have contributed their knowledge, memories
                                and ideas.</p>
                            <p>Move the map around, click the coloured points, and discover the places we've roamed.</p>
                            <p>You can add your own places to the map.
                            </p>
                            <p>The map is a bilingual space where you will encounter entries written in Welsh and
                                English and other languages too.
                                You are invited to contribute in the language of your choice. </p>
                            <p>We’d love to know your thoughts about the map.
                                Please <a href="https://www.surveymonkey.co.uk/r/BF75QZY" target="_blank">complete our
                                    survey (just 5 minutes!)</a> to let us know what you think.</p>
                            <p>Map Digi Penfro is a pilot project developed by Span Digidol tackling rural isolation
                                and community well-being through innovative digital arts projects.</p>
                        </span>
                        <span id="aboutCYM" style="color:darkblue">
                            <h1>Map Digi Penfro</h1>
                            <h3>Archwilio Sir Benfro o sawl safbwynt.</h3>
                            <p>Croeso i fersiwn Beta Map Digi Penfro, arf mapio digidol sy’n caniatáu i chi
                                recordio beth rydych chi’n meddwl sydd yn bwysig am leoedd Sir Benfro.
                                Gwaith ar y gweill yw’r map ac fe'ch gwahoddir i gyfrannu ato.</p>
                            <p>Mae’r pwyntiau ar y map hwn yn cofnodi natur, barddoniaeth, gwyddoniaeth, celf a hanes.
                                Fe’u gosodwyd yma gan bobl ifanc, pobl hen a phobl o bob oedran rhyngddynt,
                                sydd wedi cyfrannu eu gwybodaeth, eu hatgofion a’u syniadau.</p>
                            <p>Symudwch y map o gwmpas, cliciwch ar y pwyntiau lliw, a darganfyddwch y
                                lleoedd rydyn ni wedi crwydro.</p>
                            <p>Gallwch hefyd ychwanegu’r lleoedd sy’n bwysig i chi i’r map.
                            </p>
                            <p>Hoffen ni wybod eich “meddylie” am y map. Defnyddiwch y ffurflen
                                <a href="https://www.surveymonkey.co.uk/r/BF75QZY" target="_blank">yma</a>
                                i anfon eich adborth.</p>
                            <p>Datblygwyd Map Digi Penfro trwy Span Digidol prosiect peilot sy’n archwilio
                                ffyrdd y gall y celfyddydau a thechnoleg ddigidol
                                weithio ochr yn ochr i fynd i’r afael â materion megis lles cymunedol ac ynysiad
                                gwledig.</p>
                        </span>
                    </div>
                    <div id="bottombox">
                        <hr />
                        <p id="loadingFlag" style="background-color:yellow">Loading... | Llwytho...</p>
                        <button id="continueButton" style="display:none;" class="continueButton"
                            onclick="dropSplash()">Continue
                            | Parhewch</button>
                        <p><small><a href="https://www.span-arts.org.uk/" target="_blank" id="spanArtsLink">Span
                                    Arts</a> |
                                <span id="privacyOpenLink">
                                    <a href="privacy.html#privacy" title="open in new window" target="_blank">Privacy
                                        | Preifatrwydd</a> </span>
                                | <a href="img/user-guide.pdf" target="_blank" id="userGuideLink">User guide | Canllaw defnyddiwr</a>
                                | <a href='#' onclick='toggleLanguage()' id="toggleLanguageLink">Cymraeg</a>
                            </small></p>
                        <div>
                            <img src="img/logo-ccc.jpg" />
                            <img src="img/logo-eu.jpg" />
                            <img src="img/logo-arwain.jpg" />
                            <img src="img/logo-pcc.jpg" />
                        </div>
                    </div>
                </div>
                <div class="closeX boxClose" onclick="dropSplash()" style="display:none" id="splashCloseX">X</div>
            </div>
        </div>
        <div id="menu" class="menu"></div>
        <div id="message" class="dialog" onclick="g('message').style.display='none'">
            <div id="messageInner"></div>
        </div>

        <div id="signinDialog" class="dialog" onClick="onClickSignIn()">
            <div>
                <h2 id="helpRefSignIn">Please sign in</h2>
                <p id="helpRefContrib">Thanks for contributing information to the Deep Map! Before you begin:</p>
                <input id="consent" type="checkbox" onchange="g('signinButton').disabled= !this.checked " /><i><span
                        id="consentText">I confirm
                        that materials I contribute have the consent of their copyright holders.</span></i>
                <span id="termsLink"><a href="privacy.html" target="_blank">Terms</a></span>
                <br />
                <button id='signinButton' class="continueButton" onClick="onClickSignIn()" disabled="true">Sign
                    in</button>
                <p><small><i><span id="dontWantToSignIn">Don't want to sign in? Please email your additions to the map
                                to:</span>
                            <a href="mailto:alan@pantywylan.org">alan@pantywylan.org</a></i></small></p>
            </div>
        </div>

        <div id="youtube" onclick="this.style.display='none';g('youtubePlayer').src=''">
            <iframe id="youtubePlayer" type="text/html">
            </iframe>
        </div>
    </div>
    <script>
        if (window.project.id == "Folio") {
            g("spanSplash").remove();
        } else {
            g("folioSplash").remove();
        }
    </script>
</body>

</html>