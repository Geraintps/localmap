<!DOCTYPE HTML>
<html>

<head>
    <title>Span Deep Map</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <script src="scripts/azure-storage.common.min.js"></script>
    <script src="scripts/azure-storage.blob.min.js"></script>
    <script src="scripts/jquery-3.4.1.min.js"></script>
    <script src="scripts/util.js"></script>
    <script src="scripts/sign-in.js"></script>
    <script src="scripts/exif-js.js"></script>
    <script src="scripts/model.js"></script>
    <script src="scripts/azuredb.js"></script>
    <script src="scripts/online-map.js"></script>
    <script src="scripts/text-edit.js"></script>
    <script src="scripts/deep-map.js"></script>
    <script src="scripts/track.js"></script>

    <link rel="icon" type="img/png" href="img/favicon96.png" sizes="96x96" />
    <link rel="icon" type="img/png" href="img/favicon32.png" sizes="32x32" />
    <link rel="icon" type="img/png" href="img/favicon16.png" sizes="16x16" />
    <link rel="stylesheet" type="text/css" href="css/deep-map.css" />

    <style>
        #splash {
            position: absolute; top:0px; bottom: 0px; left:0px;right:0px;
            background-color: rgba(255,255,255,0.8);
            z-index: 200;
        }
        #splash>div {
            border-radius: 10px;
            border: black solid 4px;
            background-color: white;
            font: sans-serif 18pt;
            color: darkblue;
            position: absolute; top: 10%; left: 10%; right:10%;
            padding: 10px;
            display: inline-block;
        }
    </style>
</head>

<body onload="init()">
    <div>
        <div id='theMap' ondragover="dragOverMap(event)">
            <h2 style="color:grey;font-family: 'Times New Roman', Times, serif">&nbsp;
                <br />
                <br /> Loading the map... </h2>
        </div>
    </div>
    <div id="loosePicsShow"></div>
    <div id='topLeftControls'>
        <div id="usernamediv"></div>
        <div id='pauseButton' class='squareButton' onclick="onPauseButton()" title="Pause/resume tracking"><small><b>&gt;</b></small></div>
        <div id='showHelpButton' class='squareButton' onclick="showHelp()" title="help/about">?</div>
        <div id="picLaundryFlag" title="Picture or place upload in progress, or waiting for connection">^</div>
        <div id='topMessage' style="visibility: hidden"></div>
    </div>
    <div id="target" class="target" title="Position a place under here then click the button on the right to add notes">
        <div style="position:relative;top:10px">^</div>
    </div>
    <div id="addPlaceButton" class="addButton" title="Put notes and pictures on the map at the target point"
        onclick="onAddPlaceButton(this)">+</div>

    <img id="mapbutton" onclick="mapsToggleType()" title="aerial/OS map" src="img/map-icon.png" />

    <div id="popup" class="floatingPopup">
        <div id="popuptextgroup">
            <div id="toolBar1">
                <div class="toolbutton" onclick="onFormatDoc('formatblock','h4')" title="Sub heading">H</div>
                <div class="toolbutton" onclick="onFormatDoc('formatblock','div')" title="Plain paragraph">¶</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','â')">â</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','ê')">ê</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','î')">î</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','ô')">ô</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','û')">û</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','ŵ')">ŵ</div>
                <div class="toolbutton" onclick="onFormatDoc('InsertText','ŷ')">ŷ</div>
                <!-- <div class="toolbutton" onclick="onCreateLink()" title="Link a phrase to another web page">Link</div> -->
            </div>
            <div id="popuptext" contenteditable="true"></div>
        </div>
        <div id="tags"> </div>
        <div id="author"> </div>
        <div id="popclose" onclick="closePopup()">X</div>
        <div class="picturebar">
            <span id="picPrompt">Add pictures &gt;</span>
            <div id="thumbnails"></div>
            <!-- The add button displays the ugly traditional "input file" and clicks it -->
            <div class="addButton" id="addPicToPlaceButton" onclick="showFileSelectDialog('uploadToPlaceButton')"
                title="Add photos, sound files or videos to this note">+</div>
            <!-- But we set opacity:0 so the ugly input isn't visible, even when 'displayed' -->
            <input id="uploadToPlaceButton" style="display:none;opacity: 0;"
                onchange="doUploadFiles(this, this.files, g('popup').placePoint)" type="file" title="upload"
                name="uploadToPlaceButton" multiple />
        </div>
    </div>

    <!-- autoplay => Track will play automatically if user has clicked at least once in the page. -->
    <div id="audiodiv" class="avbox"><audio id='audiocontrol' controls='controls' autoplay='autoplay'
            type='audio/mpeg'></audio></div>

    <!-- Button for adding pics or other files to a place -->
    <div id="addFileButton" class="addButton" title="Upload pics and then place them on the map"
        onclick="showFileSelectDialog('uploadButton')">++</div>
    <input id="uploadButton" style="display:none;opacity: 0;" onchange="doUploadFiles(this, this.files, null)"
        type="file" title="upload" name="uploadButton" multiple />

    <div id="petals" class="petals ">
        <div id="petaltext" class="petaltext"></div>
    </div>

    <div id="petalMenu" class="menu" onmouseleave="this.style.display='none'">
        <div onclick="onmenuclick(this, titlePicCmd)">Re-title pic/file</div>
        <div onclick="onmenuclick(this, deletePicCmd)">Delete pic/file</div>
        <div onclick="onmenuclick(this, attachSoundCmd)">Attach a sound file</div>
        <!-- <div onclick="onmenuclick(this, movePicCmd)">Move pic/file to another place</div> -->
    </div>

    <div id="petalTextMenu" class="menu" onmouseleave="this.style.display='none'">
        <div onclick="onmenuclick(this, movePlaceCmd)">Move place to target</div>
        <div onclick="onmenuclick(this, deletePlaceCmd)">Delete place</div>
    </div>

    <div id="lightbox" class="lightbox" onclick="hidePic()">
        <div class="leftside lightboxside" onclick="return doLightBoxNext(-1, event)">
            <div>&#10094;</div>
        </div>
        <div class="rightside lightboxside" onclick="return doLightBoxNext(1, event)">
            <div>&#10095;</div>
        </div>

        <div class="mid">
            <div id="caption" contenteditable onclick="event.cancelBubble=true">Caption
            </div>
            <div id="imgcontainer">
                <img id="bigpic" />
            </div>
            <!-- <div id="deletePicButton" onclick='onDeletePic(this.parentElement.parentElement)'>Delete</div> -->
        </div>
    </div>

    <div id="linkDialog" class="dialog" onClick="$(this).hide();">
        <div onclick="noPropagate(event)">Paste a link to a web page here:
            <br />
            <input id="linkRef" type="text" size="20" pattern="https?://.+|\.\/\?place=[0-9]{3}"
                placeholder="http://..." />
            <input type="button" onclick="CompleteCreateLink()" value="Link" />
            <span id="linkRemoveOption">
                - or -
                <br />
                <input type="button" onclick="CompleteRemoveLink()" value="Remove link" />
            </span>
        </div>
    </div>

    <div id="titleDialog" onclick="this.style.display='none'"
        style="display:none;position:absolute;top:0px;left:0px;bottom:0px;right:0px;background-color:rgba(0,0,0,0.5)">
        <div
            style="position:absolute;top:30%;left:50%;margin-left:-30%;background-color:white;border: 2 solid blue; padding:10px;">
            <h2>Edit the title</h2>
            <input id="titleInput" type="text" size="80" onchange="onTitleDialog(this.value)" />
        </div>
    </div>

    <!-- Input dialog for adding a sound file to a pic -->
    <input id="attachSoundInput" style="display:none;opacity: 0;" onchange="doAttachSound(this)" type="file"
        title="sound file" name="attachSoundInput" />

    <!--div style="position:fixed; top:0px; left: 0px;padding:4px;background-color:yellow" id="msg"></div -->
    <div id="splash">
        <div>
            <img src="img/favicon96.png" align="left"/>
            <h1>Span Deep Map</h1>
            <h3>Explore a place from many perspectives.</h3>
            <p>The points on this map record nature, poetry, science, feelings,
                art and history. They have been placed here by people young, old, and in between,
                who have contributed their knowledge, memories, and ideas.
            </p>
            <p>Move the map around, click the coloured points, and discover the places we've roamed.</p>
            <p>You can add your own places to the map. <button onclick="dohelp()">Show me how.</button></p>
            <span style="color:darkblue">
                <h1>Map Dwfn Span</h1>
                <h3>Archwiliwch le o sawl safbwynt.</h3>
                <p>Mae’r pwyntiau ar y map hwn yn cofnodi natur, barddoniaeth, gwyddoniaeth, teimladau, 
                    celf a hanes. Fe'u gosodwyd yma gan bobl ifanc, pobl hen a phobl o bob oedran 
                    rhyngddynt, sydd wedi cyfrannu eu gwybodaeth, eu hatgofion a'u syniadau.</p>
                <p>Symudwch y map o gwmpas, cliciwch ar y pwyntiau lliw, a darganfyddwch y
                     lleoedd rydyn ni wedi crwydro.</p>
                <p>Gallwch hefyd ychwanegu’r lleoedd sy’n bwysig i chi i’r map. <button onclick="dohelp()">Dangos i mi sut.</button></p></p>
            </span>
            <hr/>
            <p id="loadingFlag">Loading... | Llwytho...</p>
            <button id="continueButton" style="display:none" onclick="g('splash').style.display = 'none'">Continue | Parhewch</button>
            <p><small><a href="https://www.span-arts.org.uk/">Span Arts</a> | <a href="https://www.span-arts.org.uk/privacy-policy/" title="open in new window" target="_blank">Privacy | Preifatrwydd</a></small></p>
        </div>
    </div>
    <div id="basehelp" style="display:none">
        <p>Drag the map so that the <span id="helpRefTarget">target <b>^</b></span> points to a place you have something to show or tell about.</p>
        <p id="helpRefTracking">If you're mobile, click &gt; to track your position.</p>
        <p id="helpRefAdd">Click <b>+</b> to create a place at the target. You'll then be able to type notes or add photos or sound files.</p>
        <p id="helpRefAddPics">If you have photos of several places, click <b>++</b> to put them on the map in one go.</p>
        <button onclick="closeBaseHelp()">Close but show help as I go along</button>
        <svg id="svg"></svg>
    </div>
    <div id="menu" class="menu"></div>

    <div id="signinDialog" class="dialog" onClick="onClickSignIn()">
        <div>
            <h2>Please sign in</h2>
            <p>Thanks for contributing information to the Deep Map! Before you begin:</p>
            <input id="consent" type="checkbox" onchange="g('signinButton').disabled= !this.checked " /><i>I confirm
                that materials I contribute have the consent of their copyright holders.</i>
            <br />
            <button id='signinButton' onClick="onClickSignIn()" disabled="true">Sign in</button>
            <p>(Don't want to sign in? Please email
                <a href="mailto:alan@pantywylan.org">alan@pantywylan.org</a> with additions to the map.)</p>
        </div>
    </div>

    <div id="youtube"
        style="position:absolute;top:0px;bottom:0px;left:0px;right:0px;background-color:rgba(0,0,0,0.5);display:none"
        onclick="this.style.display='none';g('youtubePlayer').src=''">
        <iframe id="youtubePlayer" style="position:absolute;top:20%;left:20%;height:60%;width:60%" type="text/html">
        </iframe>
    </div>
</body>

</html>