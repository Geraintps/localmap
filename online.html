<!DOCTYPE HTML>
<html>
<!--
TO DO
* Sound, video and other file types
* Discover where other photos went
* Dynamic update - polling
* Welsh option
* Push to online map
* Prettier, animated display of points
* In popped view, place texts, and pics on screen, set bkgnd colour/img
* Tag media; invent new tags
* Adjust place position, delete place
* Expand text
* Automatic positioning of photos that have loc metadata
* Drone view - sync w drone movement
-->

<head>
    <title>Span Deep Map</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
   
    <script src="scripts/util.js"></script>
    <script src="scripts/exif-js.js"></script>
    <script src="scripts/filedb.js"></script>
  <!--  <script src="scripts/jquery-3.4.1.min.js"></script>
    <script src="scripts/online-map.js"></script>
    <script src="scripts/deep-map.js"></script>
    <script src="scripts/track.js"></script>
    -->

    <link rel="stylesheet" type="text/css" href="css/deep-map.css" />
    <script>
        
function init() {
 //   makeTags();
    setUpMap();
 //   setPetals();
}

function doLoadMap() {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.async = true;
    script.defer = true;
    script.type = 'text/javascript';
    script.src = 'https://www.bing.com/api/maps/mapcontrol?key=' + window.keys.Client_Map_K + '&callback=mapModuleLoaded';
    head.appendChild(script);
}

function setUpMap() {
    getKeys(function (data) {
        window.keys = data;
        doLoadMap();
    }
    );
}

function mapModuleLoaded() {
    // Arbitrary place to centre the map before GPS location is acquired:
    window.here = new Microsoft.Maps.Location(52.008144, -5.067547);

    var centerFromCookie = getCookie("mapCenter");
    if (centerFromCookie) {
        window.here = Microsoft.Maps.Location.parseLatLong(centerFromCookie)
            || window.here;
    }

    // Load map:
    window.map = new Microsoft.Maps.Map(document.getElementById('theMap'),
        {
            mapTypeId: Microsoft.Maps.MapTypeId.aerial,
            center: window.here,
            showLocateMeButton: false,
            //showMapTypeSelector: false,
            showZoomButtons: true,
            disableBirdseye: true,
            disableKeyboardInput: true,
            disableStreetside: true,
            enableClickableLogo: false,
            navigationBarMode: Microsoft.Maps.NavigationBarMode.compact,
            zoom: 17
        });
/*
    setUpMapClick();
    setUpMapMenu();
*/
    /*
    // Minor convenience: If user selects OS map, zoom out so that actual OS shows:
    Microsoft.Maps.Events.addHandler(window.map, 'maptypechanged', function () {
        var mapTypeId = window.map.getMapTypeId();
        if (mapTypeId == Microsoft.Maps.MapTypeId.ordnanceSurvey && window.map.getZoom() > 17) {
            setTimeout(function () { window.map.setView({ zoom: 17 }) }, 300);
        }
    });
    */

    Microsoft.Maps.Events.addHandler(map, 'viewchangeend', setStreetOsLayer);

 //   loadPlaces();
    g("splash").style.display = "none";
}
    </script>
</head>

<body onload="init()">
    <div id='theMap'>
        <h2 style="color:darkgreen;font-family: 'Times New Roman', Times, serif">&nbsp;
            <br />
            <br /> Just a moment please... </h2>
    </div>
    <!--
    <div id='topLeftControls'>
        <div id="usernamediv"></div>
        <div id='pauseButton' onclick="onPauseButton()"><small><b>||</b></small></div>
        <div id='topMessage' style="visibility: hidden"></div>
    </div>
    <div id="target" class="target noselect">+</div>
    <div id="addPlaceButton" class="addButton" title="Add stuff at the target" onclick="onAddPlaceButton(this)">+</div>

    <div id="popup" class="floatingPopup">
        <div id="popuptext" contenteditable="true"></div>
        <div id="tags"> </div>
        <div id="author"> </div>
        <div id="popclose" onclick="closePopup()">X</div>
        <div class="picturebar">
            <span id="picPrompt">Add pictures &gt;</span>
            <div id="thumbnails"></div>

            <div class="addButton" id="addPicToPlaceButton" onclick="onClickAddFiles('uploadToPlaceButton')"
                title="Add photos, sound or videos to this note">+</div>
            <input id="uploadToPlaceButton" style="display:none;opacity: 0;"
                onchange="doUploadFiles(this, this.files, g('popup').placePoint.place)" type="file" title="upload"
                name="Upload" multiple />
        </div>
    </div>


    <div id="loosePicsShow" class="noselect"></div>

    <div id="addFileButton" class="addButton" title="Add pics and let us place them on the map"
        onclick="onClickAddFiles('uploadButton')">++</div>
    <input id="uploadButton" style="display:none;opacity: 0;" onchange="doUploadFiles(this, this.files, null)"
        type="file" title="upload" name="Upload" multiple />

    <div id="petals" class="petals ">
        <div id="petaltext" class="petaltext" ></div>
    </div>


    <div id="lightbox" class="lightbox" onclick="hidePic()">
        <div>
            <div id="caption" contenteditable onclick="event.cancelBubble=true">Caption
            </div>
            <img id="bigpic" />
            <div id="deletePicButton" onclick='onDeletePic()'>Delete</div>
        </div>
    </div>

    <div id="splash">
        <h1>Loading ...</h1>
    </div>
    <div id="menu" class="menu"></div>
    <div id="signin" class="lightbox">
        <div style="background-color: cornsilk; padding: 10%">
            <h1>Please sign in</h1>
            <p>Your name or name of your team:</p>
            <input type="text" onchange="signedin(this)" />
        </div>
    </div> -->
</body>

</html>